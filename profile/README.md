Welcome to the GitHub organization for building Red List of Ecosystems (RLE) assessment reports.

## How to create a new assessment report

Prerequisites
- A [GitHub](https://github.com/) account
- A [Google Cloud Project](https://console.cloud.google.com/) account and project

Detailed Steps

1. **Fork the template repository**
    1. In a new window (so you can still read these instructions), open https://github.com/RLE-Assessment/TEMPLATE-rle-assessment
    2. Select **Use this template** > **Create a new repository**
        1. Under **Include all branches**, select **On**
        2. Populate the **Repository name**. For example: "*ruritania-rle-assessment*"
        3. Add a **Description** for the repository. For example: "*An IUCN Red List of Ecosystems assessment for Ruritania*"
        4. Click **Create Repository**
    3. On the main page of your new repository, in the About section, click on the gear icon to edit the repository details.
        1. In the **Website** section, check the **Use your GitHub Pages website** option
        2. In the **Include in the home page** section, uncheck the **Packages** option
        2. Click **Save Changes**
    3. Go to the **Actions** tab, and wait for the workflow to run. (It is deploying content to GitHub Pages.)
        1. The workflow will likely fail with the error `Branch "main" is not allowed to deploy to github-pages due to environment protection rules.`
    4. Configure environment protection
        1. Go to your repository on GitHub
        2. Navigate to Settings > Environments
        3. Click on github-pages
        4. Under "Deployment branches and tags", click Add deployment branch or tag rule and add `main`
    5. Configure GCP authentication
        1. Add IAM binding for the new repository
            1. Replace PROJECT_NUMBER with your actual GCP project number and the REPO_NAME with your repository name:
            ```
            # Set these values for your template repository
            PROJECT_ID=
            REPO_NAME=
            REPO_OWNER=

            PROJECT_NUMBER=$(gcloud projects describe ${PROJECT_ID} --format="value(projectNumber)")

            # Add IAM binding
            gcloud iam service-accounts add-iam-policy-binding \
            "github-actions-rle@goog-rle-assessments.iam.gserviceaccount.com" \
            --project="goog-rle-assessments" \
            --role="roles/iam.workloadIdentityUser" \
            --member="principalSet://iam.googleapis.com/projects/${PROJECT_NUMBER}/locations/global/workloadIdentityPools/github-pool/attribute.repository/${REPO_OWNER}/${REPO_NAME}"
            ```
        2. Add secrets to the new repository
            1. Go to **Settings** > **Secrets and variables** > **Actions** for the templated repository and add:
                | Secret | Value |
                |---|---|
                | GCP_WORKLOAD_IDENTITY_PROVIDER | `projects/PROJECT_NUMBER/locations/global/workloadIdentityPools/github-pool/providers/github-provider` |
                | GCP_SERVICE_ACCOUNT | `github-actions-rle@goog-rle-assessments.iam.gserviceaccount.com` |

        3. [***TODO Rerun Jobs***]
            1. Go to the templated repository's Actions tab, and re-run the last failed workflow. This time it should succeed, due to the new GCP configuration.
    4. On the main page, in the **About** section, click on the URL link to open the website generated by the repository.
        1. Look through the website, using the navigation menu on the left hand side.
        2. Note that there are numerous red warning boxes that provide instructions for customizing the website. 

## How to edit the assessment report

1. **Create a local clone**
    1. From the GitHub Web UI, select **<> Code** > **Local**
2. **Install the local environment**
    1. If needed, [install the Pixi package manager](https://pixi.prefix.dev/latest/installation/) on your local computer.
    2. Run `pixi install`